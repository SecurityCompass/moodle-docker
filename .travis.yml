# Define build stages
stages:
  - tests
  - name: build
    if: branch = master
  - name: publish
    if: branch = master

# Ignore submodules for all stages
git:
  submodules: false

jobs:
  include:
    - stage: "Tests"
      name: "Shellcheck"
      env:
        - SHELLCHECK_OPTS="-e SC1008 -e SC2154"
      language: bash
      script:
        - shellcheck $(find . -type f -name '*.sh')
    - stage: "Build"
      name: "Build Docker image"
      language: minimal
      sudo: required
      services:
        - docker
      script:
        - ls
        - docker ps
        - docker images
        - docker --version
        - docker-compose --version
        - true
    - name: "Build DEB package"
      language: bash
      script: true
    - stage: "Publish"
      name: "Push docker image"
      language: bash
      script: true
    - name: "Push DEB package"
      language: bash
      script: true
